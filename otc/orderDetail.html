<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>购买订单</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<link rel="stylesheet" href="css/mui.min.css">
	<style>
		.mui-content {
			font-size: 14px;
		}

		.mui-table-view-cell.mui-active {
			background-color: #FFFFFF !important;
		}

		.mui-table-view-cell:after {
			height: 0;
		}

		.mui-table-view {
			margin-bottom: 10px;
		}

		.order_num {
			float: left;
			width: 70%;
		}

		.info_title {
			color: #8F8F94;
			width: 40%;
			float: left;
		}

		.mui-btn {
			width: 40%;
			border-radius: 30px
		}
	</style>
</head>

<body>
<header class="mui-bar mui-bar-nav">
	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	<h1 class="mui-title">购买订单</h1>
</header>
<div class="mui-content">
	<ul class="mui-table-view">
		<li class="mui-table-view-cell">
			<div class="order_num">
				订单号：<span id="TradeIdArea"></span>
			</div>
			<div class="" style="float: right;" id="EnsureStatusDisplayArea"></div>
		</li>
	</ul>

	<ul class="mui-table-view">
		<li class="mui-table-view-cell">
			<div class="info_title">
				出售者
			</div>
			<div class="info_content" id="SellerNameArea"></div>
		</li>
		<li class="mui-table-view-cell">
			<div class="info_title">
				订单金额（CNY）
			</div>
			<div class="info_content" id="MoneyArea"></div>
		</li>
		<li class="mui-table-view-cell">
			<div class="info_title">
				数量（TF）
			</div>
			<div class="info_content" id="AmountArea"></div>
		</li>
		<li class="mui-table-view-cell">
			<div class="info_title">
				单价（CNY）
			</div>
			<div class="info_content" id="UnivalentArea"></div>
		</li>
		<li class="mui-table-view-cell">
			<div class="info_title">
				下单时间
			</div>
			<div class="info_content" id="CreateTimeArea"></div>
		</li>
	</ul>
	<ul class="mui-table-view">
		<li class="mui-table-view-cell">
			<div class="order_num">
				收款方：
			</div>
			<div class="" style="float: right;color: blue;">
				支付宝
			</div>
		</li>
		<li class="mui-table-view-cell">
			<div class="" style="float: left; width: 40%;">
				姓名
			</div>
			<div class="" style="float: left;" id="RealNameArea"></div>
		</li>
		<li class="mui-table-view-cell">
			<div class="" style="float: left; width: 40%;">
				账号
			</div>
			<div class="" style="float: left;" id="AlipayArea"></div>
		</li>

	</ul>
	<div class="mui-button-row">
		<!--<button type="button" class="mui-btn mui-btn-danger">取消订单</button>-->
		<button type="button" class="mui-btn mui-btn-primary" id="MarkPayBtn" style="display: none;" onclick="ensurePay()">标记已付款</button>
		<div style="display: none;" id="Tips">等待对方确认收款</div>
	</div>
</div>
<script src="js/mui.min.js"></script>
<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery-2.1.4.js" type="text/javascript" charset="utf-8"></script>
<script>
    mui.init();
    var id = jsAjax.getQueryString("id");
    jsAjax.getOrder(id ,function(data){
        console.log(data);
        var trade = data.trade;
        var buyer = data.buyer;
        var seller = data.seller;
        $("#TradeIdArea").text(trade.id)
        var ensureStatus = trade.ensureStatus;
        if(ensureStatus == "ensure4pay"){
            $("#Tips").show();
            $("#EnsureStatusDisplayArea").text("待释放");
        }else if(trade.ensureStatus == "none") {
            $("#MarkPayBtn").show();
            $("#EnsureStatusDisplayArea").text("待确认付款");
        }else{
            $("#EnsureStatusDisplayArea").text("未知");
        }
        $("#SellerNameArea").text(seller.name + " / " + seller.mobile);
        $("#MoneyArea").text(trade.money);
        $("#AmountArea").text(trade.amount);
        $("#UnivalentArea").text(trade.univalent);
        $("#CreateTimeArea").text(jsAjax.formatLongTime(trade.createTime))
        $("#RealNameArea").text(seller.realName);
        $("#AlipayArea").text(seller.alipayAddress);
    });

    function ensurePay(){
        var btnArray = ['取消', '确认'];
        mui.confirm("确认是否已付款", '', btnArray, function(e) {
            if(e.index == 0) {
                return;
            }
            var params = {
                type: "post",
                url: "/trade/order/ensure4pay/" + id
            };
            jsAjax.ajax(params, function(data){
                mui.alert("标记付款成功");
				mui.back();
            },function (XMLHttpRequest) {
                if(XMLHttpRequest == "relogin") {
                    mui.alert("登陆过期，请重新登陆")
                    location.href = "index.html"
                } else {
                    mui.alert(XMLHttpRequest.responseJSON.message)
                }
            })
        })
    }

    /*document.querySelectorAll("button")[0].onclick = function() {
        console.log("取消")

        var btnArray = ['取消', '确认'];
        mui.confirm("确认取消订单", '', btnArray, function(e) {
            if(e.index == 1) {
                console.log("确认")
            } else {
                console.log("取消")
            }
        })
    }*/
</script>
</body>

</html>