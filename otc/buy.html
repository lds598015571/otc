<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>购买</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="css/mui.min.css" rel="stylesheet" />
	<style type="text/css">
		.mui-row {
			background-color: #fff;
		}

		.mui-input-group:before {
			background-color: #FFFFFF;
		}

		.mui-input-row label {
			padding: 10px 1px;
		}

		.user_img {
			width: 40%;
			margin: 15px;
		}

		.user_num {
			text-align: center;
			margin-top: 25px;
		}

		.user_info {
			margin-top: 10px;
		}

		.user_info2 {
			text-align: center;
		}

		.user_info2_text {
			margin-top: 5px;
		}

		.user_sm {
			font-size: 14px;
			margin: 10px;
			padding-top: 10px;
			border-top: 1px solid #F3F3F3;
		}

		.buy_title {
			font-size: 25px;
			margin: 15px;
		}

		.user_tx {
			margin: 15px;
			font-size: 14px;
			font-family: Consolas;
		}

		.footer {
			width: 100%;
			/*padding: 5% 10px;*/
			background-color: #FFF;
			position: fixed;
			bottom: 0;
		}

		.footer span {
			margin-right: 10px;
		}

		.lxdf {
			float: left;
			margin: 15px 10px;
		}

		.buy_btn {
			float: right;
			color: #FFFFFF;
			background-color: #007AFF;
			border: none;
			border-radius: 0;
			height: 60px;
			width: 100px;
		}

		.tj_left {
			float: left;
		}

		.tj_right {
			float: right;
		}
		.tj_ts {
			color: red;
		}
		.text-small{
			font-size: 10px;
			font-family: Consolas;
		}
	</style>
</head>

<body>
<header class="mui-action-back mui-bar mui-bar-nav mui-bar-transparent">
	<a class="mui-icon mui-icon-left-nav mui-pull-left"></a>
	<h1 class="mui-title">购买</h1>
</header>

<div class="mui-content">
	<div class="mui-row">
		<div class="mui-col-xs-3" style="text-align: center;">
			<img class="user_img" src="img/user-photo.png" />
		</div>
		<div class="mui-col-xs-6">
			<div class="user_info" id="GdUserNameArea"></div>
			<div class="user_info">
				<span class="text-small">总量/剩余</span> <span id="GdAllAmount"></span>/<span id="GdRestAmount"></span>
			</div>
		</div>
		<!--<div class="mui-col-xs-3">
			<div class="user_num">
				<span id="GdIdeaUnivalent"></span>CNY
			</div>
			<div class="user_num">
				单价
			</div>
		</div>-->
		<div class="mui-col-xs-3">
			<div class="user_info">
				<span id="GdIdeaUnivalent"></span> <span class="text-small">CNY</span>
			</div>
			<div class="user_info">
				<span class="text-small">单价</span>
			</div>
		</div>
	</div>
	<div class="mui-row user_info2">
		<div class="mui-col-xs-3">
			<div class="user_info2_text">
				<span id="GdMinAmount">**</span>
			</div>
			<div class="user_info2_text">
				最小限额
			</div>
		</div>
		<div class="mui-col-xs-3">
			<div class="user_info2_text">
				<span id="GdMaxAmount">**</span>
			</div>
			<div class="user_info2_text">
				最大限额
			</div>
		</div>
		<div class="mui-col-xs-3">
			<div class="user_info2_text">
				<span id="GdTradeCount">***</span>
			</div>
			<div class="user_info2_text">
				交易次数
			</div>
		</div>
		<div class="mui-col-xs-3">
			<div class="user_info2_text">
				<span id="GdFinishedCount">***</span>
			</div>
			<div class="user_info2_text">
				历史成交
			</div>
		</div>
	</div>
	<div class="mui-row">
		<div class="mui-col-xs-12">
			<div class="user_sm">
				挂单留言：<span id="GdMsg"></span>
			</div>
		</div>
	</div>
	<div class="mui-row" style="margin-top: 10px;padding-bottom: 20px;">
		<div class="mui-col-xs-12">
			<div class="buy_title">
				你想购买多少？
			</div>
		</div>
		<div class="mui-col-xs-5">
			<div class="mui-input-group">
				<div class="mui-input-row" style="margin-left:10px ;">
					<label>CNY：</label>
					<input type="text" id="GdMoney" class="mui-input-clear" readonly style="padding-right: 0;" />
				</div>
			</div>
		</div>
		<div class="mui-col-xs-2">
			<div class="" style="text-align: center;margin-top: 5px;">
				←
			</div>
			<div class="" style="text-align: center;margin-top: -15px;">
				→
			</div>
		</div>
		<div class="mui-col-xs-5">
			<div class="mui-input-group">
				<div class="mui-input-row">
					<label>TF：</label>
					<input type="number" id="GdAmount" max="999999" oninput="fitMoneyIpt(this)" class="mui-input-clear" placeholder="购买数量" style="padding-right: 0;" />
				</div>
			</div>
		</div>
	</div>
	<div class="mui-row" style="margin-top: 10px;margin-bottom: 20%;">
		<div class="mui-col-xs-12">
			<div class="user_tx">
				<div class="">
					交易提醒：
				</div>
				<div class="">
					1、请勿备注BTC·ETH·USDT以及其他数字资产名字进行备注，防止对您的汇款进行拦截
				</div>
				<div class="">
					2、非工作时间（节假日和工作日的17:00-8:00）大于5万的跨行转款，请分批支付（少于5W可以及时到账）
				</div>
				<div class="">
					3、请使用及时到账的方式，支付宝转银行卡会比较慢，卖家有权退回款项和取消订单
				</div>
			</div>
		</div>
	</div>
	<div class="footer">
		<div class="mui-row">
			<div class="lxdf">
				<!--<span class="mui-icon mui-icon-chat"></span><span id="">联系对方</span>-->
			</div>
			<button class="buy_btn">购买</button>
		</div>

	</div>
</div>

<script src="js/mui.min.js"></script>
<script src="js/jquery-2.1.4.js" type="text/javascript" charset="utf-8"></script>
<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
<script src="js/arttmpl.js"></script>
<script type="text/template" id="tips">
	<%
	<div class="tj_left">购买价格</div><div class="tj_right"><%=item.univalent%>CNY</div><div class="mui-clearfix"></div><div class="tj_left">购买金额</div><div class="tj_right"><%=item.money%> CNY</div><div class="mui-clearfix"></div><div class="tj_left">购买数量</div><div class="tj_right"><%=item.amount%> TF</div><div class="mui-clearfix"></div>
	<div class="tj_ts">提醒：请确认价格再下单，下单后此交易的数字货币将托管锁定，请放心购买。</div>
	%>
</script>

<script type="text/javascript">
    mui.init()

    var info = {};

    document.querySelector("header").querySelector("a").onclick = function() {
        history.back(-1)
    }

    jsAjax.getPreTrade(jsAjax.getQueryString("id"),function(data){
        console.log(data);
        info = data;
        $("#GdUserNameArea").text(data.name)
        $("#GdIdeaUnivalent").text(data.preTrade.ideaUnivalent);
        // $("#GdTradeCount").text(data.tradeCount);
        // $("#GdFinishedCount").text(data.finishCount);
        $("#GdMsg").text(data.preTrade.message);
        $("#GdMinAmount").text(data.preTrade.minAmount);
        $("#GdMaxAmount").text(data.preTrade.maxAmount);
        $("#GdAllAmount").text(data.preTrade.allAmount);
        $("#GdRestAmount").text(data.preTrade.restAmount);
    });

    /*document.querySelector(".buy_btn").onclick = function() {
        var _html = '<div class="tj_left">购买价格</div><div class="tj_right">6.63 CNY</div>	<div class="mui-clearfix"></div>			<div class="tj_left">				购买金额			</div>			<div class="tj_right">				6123.63332 CNY			</div>			<div class="mui-clearfix"></div>			<div class="tj_left">				购买数量			</div>			<div class="tj_right">				2213126.63213123 USDT			</div>			<div class="mui-clearfix"></div>			<div class="tj_ts">				提醒：请确认价格再下单，下单后此交易的USDT将托管锁定，请放心购买。			</div>';
        var btnArray = ['取消', '确认'];
        mui.confirm(_html, '下单确认', btnArray, function(e) {
            if(e.index == 1) {
                console.log("确认")
            }else{
                console.log("取消")
            }
        })
    }*/
    document.querySelector(".buy_btn").onclick = function() {
        var data = {
            univalent: info.preTrade.ideaUnivalent,
            amount: $("#GdAmount").val(),
            money: $("#GdMoney").val()
        };
        if(data.amount == "" || data.amount == null || parseInt(data.amount) > info.preTrade.maxAmount || data.amount < info.preTrade.minAmount) {
            mui.alert("请输入正确的数量，不能超出限额");
            return;
        }
        var _html = template('tips',{
            item: data
        });
        var btnArray = ['取消', '确认'];
        mui.confirm(_html, '下单确认', btnArray, function(e) {
            if(e.index == 0) {
                return;
            }
            // 提交购买单：
            submitTrade();
        })
    }
    function fitMoneyIpt(ele){
        console.log(ele.value);
        $("#GdMoney").val(ele.value * info.preTrade.ideaUnivalent);
    }

    function submitTrade(){
        var data = {
			preId: info.preTrade.id,
			amount: $("#GdAmount").val()
		};
        var params = {
            data: data,
			url: "/trade/order/submit",
			type: "post"
		};
        jsAjax.ajax(params, function(data) {
            mui.alert("购买成功")
            location.href = "index.html";
        }, function(XMLHttpRequest) {
            if(XMLHttpRequest == "relogin") {
                mui.alert("登陆过期，请重新登陆")
                location.href = "index.html"
            } else {
                mui.alert(XMLHttpRequest.responseJSON.message)
            }
        });
	}


</script>
</body>

</html>